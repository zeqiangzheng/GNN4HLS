import os
import sys
import shutil

#folders = sys.argv[1:]

folders = ["output", "autogenerated", "output_sitao"]

dest = "+".join(folders)
os.mkdir(dest)

all_hls_csv = open(dest + "/HLS_report.csv", "w")
all_rtl_csv = open(dest + "/RTL_report.csv", "w")

bench_set = set()

j = 0
for i in range(len(folders)):
    folder = folders[i]
    if not os.path.isdir(folder):
        shutil.unpack_archive(folder + ".zip", ".")
        
    hls_csv = open(folder + "/HLS_report.csv", "r")
    rtl_csv = open(folder + "/RTL_report.csv", "r")
    hls_0 = hls_csv.readline()
    rtl_0 = rtl_csv.readline()
    print("\nFolder #", i, folder)
    if i == 0: # first folder: keep the first line
        all_hls_csv.write(hls_0)
        all_rtl_csv.write(rtl_0)
    while True:
        hls_k = hls_csv.readline()
        rtl_k = rtl_csv.readline()
        #print(hls_k, rtl_k)
        if not hls_k or not rtl_k:
            hls_csv.close()
            rtl_csv.close()
            break
        bench_name = hls_k.split(",")[0] # same IDs as rtl_k
        if bench_name not in bench_set:
            print(j, ":", bench_name, end=", ")
            j += 1
            bench_set.add(bench_name)
            all_hls_csv.write(hls_k)
            all_rtl_csv.write(rtl_k)
            src_dir = folder + "/" + bench_name
            dest_dir = dest + "/" + bench_name            
            shutil.copytree(src_dir, dest_dir)

all_hls_csv.close()
all_rtl_csv.close()
shutil.make_archive(dest + ".zip", 'zip', dest)
    
    
    
